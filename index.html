<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Virtual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        .piano-key {
            transition: transform 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .piano-key:active {
            transform: scale(0.98);
        }
        .white-key {
            width: 60px;
            height: 200px;
            background-color: #f0f0f0;
            border: 1px solid #c0c0c0;
            border-radius: 0 0 8px 8px;
            position: relative;
            z-index: 1;
        }
        .black-key {
            width: 40px;
            height: 120px;
            background-color: #333;
            border: 1px solid #1a1a1a;
            border-radius: 0 0 6px 6px;
            position: absolute;
            z-index: 2;
            top: 0;
        }
        .key-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #555;
            font-weight: bold;
        }
        .black-key .key-label {
            color: #f0f0f0;
            bottom: 5px;
        }
        .note-name {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            font-weight: bold;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div class="flex flex-col items-center p-4 md:p-8 bg-gray-800 rounded-2xl shadow-lg border border-gray-700">
        <h1 class="text-3xl md:text-4xl font-bold mb-4">Piano Virtual</h1>
        <p class="text-gray-400 mb-8 text-center max-w-lg">
            Toque nas teclas com o mouse ou use o teclado para tocar o piano! As notas e as teclas correspondentes são exibidas nas teclas.
        </p>

        <div id="piano" class="flex justify-center relative rounded-xl overflow-hidden shadow-2xl">
            <!-- As teclas do piano serão geradas aqui com JavaScript -->
        </div>

        <div class="mt-8 flex space-x-4">
            <button id="play-fur-elise" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 active:scale-100 disabled:bg-gray-500 disabled:cursor-not-allowed">
                Tocar "Für Elise"
            </button>
            <button id="play-megalovania" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 active:scale-100 disabled:bg-gray-500 disabled:cursor-not-allowed">
                Tocar "MEGALOVANIA"
            </button>
        </div>

        <div id="message-box" class="mt-8 p-4 bg-gray-700 text-gray-200 rounded-lg hidden"></div>
    </div>

    <script>
        const piano = document.getElementById('piano');
        const messageBox = document.getElementById('message-box');
        
        // Mapeamento de notas para frequências
        const notes = {
            'A#3': 233.08, 'B3': 246.94,
            'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.31, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
            'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99, 'G#5': 830.61, 'A5': 880.00, 'A#5': 932.33, 'B5': 987.77,
        };

        const keyMap = {
            'z': 'C4', 's': 'C#4', 'x': 'D4', 'd': 'D#4', 'c': 'E4', 'v': 'F4', 'g': 'F#4',
            'b': 'G4', 'h': 'G#4', 'n': 'A4', 'j': 'A#4', 'm': 'B4',
            'q': 'C5', '2': 'C#5', 'w': 'D5', '3': 'D#5', 'e': 'E5', 'r': 'F5', '5': 'F#5',
            't': 'G5', '6': 'G#5', 'y': 'A5', '7': 'A#5', 'u': 'B5'
        };

        const furEliseMelody = [
            { note: 'E5', duration: 300 }, { note: 'D#5', duration: 300 }, { note: 'E5', duration: 300 }, { note: 'D#5', duration: 300 }, { note: 'E5', duration: 300 },
            { note: 'B4', duration: 300 }, { note: 'D5', duration: 300 }, { note: 'C5', duration: 300 }, { note: 'A4', duration: 600 },
            { note: 'A4', duration: 300 }, { note: 'C4', duration: 300 }, { note: 'E4', duration: 300 }, { note: 'A4', duration: 300 }, { note: 'B4', duration: 600 },
            { note: 'G#4', duration: 300 }, { note: 'B4', duration: 300 }, { note: 'C5', duration: 600 },
            { note: 'E5', duration: 300 }, { note: 'D#5', duration: 300 }, { note: 'E5', duration: 300 }, { note: 'D#5', duration: 300 }, { note: 'E5', duration: 300 },
            { note: 'B4', duration: 300 }, { note: 'D5', duration: 300 }, { note: 'C5', duration: 300 }, { note: 'A4', duration: 600 },
            { note: 'A4', duration: 300 }, { note: 'C4', duration: 300 }, { note: 'E4', duration: 300 }, { note: 'A4', duration: 300 }, { note: 'B4', duration: 600 },
            { note: 'C5', duration: 300 }, { note: 'B4', duration: 300 }, { note: 'A4', duration: 600 },
        ];

        const megalovaniaMelody = [
            { note: 'D4', duration: 150 }, { note: 'D4', duration: 150 }, { note: 'D5', duration: 150 }, { note: 'A4', duration: 150 }, { note: 'G#4', duration: 150 }, { note: 'G4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'D4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'G4', duration: 150 },
            { note: 'C4', duration: 150 }, { note: 'C4', duration: 150 }, { note: 'D5', duration: 150 }, { note: 'A4', duration: 150 }, { note: 'G#4', duration: 150 }, { note: 'G4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'D4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'G4', duration: 150 },
            { note: 'B3', duration: 150 }, { note: 'B3', duration: 150 }, { note: 'D5', duration: 150 }, { note: 'A4', duration: 150 }, { note: 'G#4', duration: 150 }, { note: 'G4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'D4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'G4', duration: 150 },
            { note: 'A#3', duration: 150 }, { note: 'A#3', duration: 150 }, { note: 'D5', duration: 150 }, { note: 'A4', duration: 150 }, { note: 'G#4', duration: 150 }, { note: 'G4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'D4', duration: 150 }, { note: 'F4', duration: 150 }, { note: 'G4', duration: 150 },
        ];

        const keyElements = {};
        let audioContext;
        let oscillator;
        let gainNode;
        
        // Verifica se a API de áudio é suportada
        try {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            showMessage('Desculpe, a API de áudio do seu navegador não é suportada. O som não funcionará.');
        }

        function createPiano() {
            const whiteKeys = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5', 'D5', 'E5', 'F5', 'G5', 'A5', 'B5'];
            const blackKeys = ['C#4', 'D#4', 'F#4', 'G#4', 'A#4', 'C#5', 'D#5', 'F#5', 'G#5', 'A#5'];

            const whiteKeyContainer = document.createElement('div');
            whiteKeyContainer.className = 'flex';
            piano.appendChild(whiteKeyContainer);

            let whiteKeyIndex = 0;
            const allNotes = Object.keys(keyMap).map(key => keyMap[key]);

            const pianoKeys = document.createDocumentFragment();

            whiteKeys.forEach(note => {
                const key = document.createElement('div');
                key.className = 'piano-key white-key flex items-end justify-center rounded-b-lg shadow-md hover:bg-gray-300 active:bg-gray-400';
                key.dataset.note = note;
                const keyLabel = Object.keys(keyMap).find(k => keyMap[k] === note) || '';
                key.innerHTML = `<span class="note-name text-gray-800">${note}</span><span class="key-label text-gray-500">${keyLabel.toUpperCase()}</span>`;
                whiteKeyContainer.appendChild(key);
                keyElements[note] = key;

                // Adiciona a tecla preta correspondente
                const sharpNote = note.charAt(0) + '#' + note.charAt(1);
                if (blackKeys.includes(sharpNote)) {
                    const blackKey = document.createElement('div');
                    blackKey.className = 'piano-key black-key flex items-end justify-center rounded-b-lg shadow-md hover:bg-gray-800 active:bg-black';
                    blackKey.dataset.note = sharpNote;
                    const blackKeyLabel = Object.keys(keyMap).find(k => keyMap[k] === sharpNote) || '';
                    blackKey.innerHTML = `<span class="note-name text-white">${sharpNote}</span><span class="key-label text-gray-400">${blackKeyLabel.toUpperCase()}</span>`;
                    blackKey.style.left = `${(whiteKeyIndex * 60) + 40}px`;
                    piano.appendChild(blackKey);
                    keyElements[sharpNote] = blackKey;
                }
                whiteKeyIndex++;
            });
        }

        function playNote(note) {
            if (!audioContext || !notes[note]) return;

            // Resume o contexto de áudio se estiver suspenso
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            const frequency = notes[note];
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.value = frequency;

            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.01);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + 0.5);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function playMelody(melody) {
            for (const note of melody) {
                playNote(note.note);
                await delay(note.duration);
            }
        }

        function showMessage(msg) {
            messageBox.textContent = msg;
            messageBox.classList.remove('hidden');
        }

        // Event listeners para clique do mouse
        piano.addEventListener('mousedown', (e) => {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            const key = e.target.closest('.piano-key');
            if (key) {
                const note = key.dataset.note;
                playNote(note);
                key.classList.add('active');
            }
        });

        piano.addEventListener('mouseup', (e) => {
            const key = e.target.closest('.piano-key');
            if (key) {
                key.classList.remove('active');
            }
        });

        // Event listeners para teclas do teclado
        window.addEventListener('keydown', (e) => {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            const key = e.key.toLowerCase();
            const note = keyMap[key];
            if (note && !e.repeat) {
                playNote(note);
                if (keyElements[note]) {
                    keyElements[note].classList.add('active');
                }
            }
        });

        window.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            const note = keyMap[key];
            if (note && keyElements[note]) {
                keyElements[note].classList.remove('active');
            }
        });

        // Inicia a criação do piano quando a página carregar
        createPiano();

        const playFurEliseButton = document.getElementById('play-fur-elise');
        playFurEliseButton.addEventListener('click', async () => {
            playFurEliseButton.disabled = true;
            playMegalovaniaButton.disabled = true;
            playFurEliseButton.textContent = 'Tocando...';
            await playMelody(furEliseMelody);
            playFurEliseButton.disabled = false;
            playMegalovaniaButton.disabled = false;
            playFurEliseButton.textContent = 'Tocar "Für Elise"';
        });

        const playMegalovaniaButton = document.getElementById('play-megalovania');
        playMegalovaniaButton.addEventListener('click', async () => {
            playMegalovaniaButton.disabled = true;
            playFurEliseButton.disabled = true;
            playMegalovaniaButton.textContent = 'Tocando...';
            await playMelody(megalovaniaMelody);
            playMegalovaniaButton.disabled = false;
            playFurEliseButton.disabled = false;
            playMegalovaniaButton.textContent = 'Tocar "MEGALOVANIA"';
        });
    </script>

</body>
</html>
